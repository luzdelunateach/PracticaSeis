@page
<h1>Registry a Product</h1>
<form method="post" action="/products" id="myForm">
    <div class="form-group">
        <label for="Name">Name</label>
        <input id="Name" name="Name" class="form-control" />
    </div>
    <div class="form-group">
        <label for="Stock">Stock</label>
        <input id="Stock" name="Stock" class="form-control" />
    </div>
    <div class="form-group">
        <label for="Price">Price</label>
        <input id="Price" name="Price" class="form-control" />
    </div>
    <div class="form-group">
        <label for="Sku">Sku</label>
        <input id="Sku" name="Sku" class="form-control" />
    </div>
    <div class="form-group">
        <label for="Description">Description</label>
        <input id="Description" name="Description" class="form-control" />
    </div>
    <div class="form-group">
        <label for="Brand">Brand</label>
        <input id="Brand" name="Brand" class="form-control" />
    </div>
    <div id="selectContainer" class="mb-3">




    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-primary">Save</button>
    </div>
    <div id="alert"></div>
</form>

@section Scripts{
    <script>
        var isBusy = false;
        $(function () {
            loadData();
        });

        function loadData() {
            $.ajax({
                type: 'GET',
                url: '/api/subdepartment/',
                data: 'json',
                contentType: 'application/json',
                success: function (subdep) {
                    var html = '<label for="Subdepartment">Subdepartaments</label><select name="Subdeparment" class="form-control">';
                    for (var i in subdep) {
                        html += '<option value="' + subdep[i].id + '">' + subdep[i].name + '</option>';
                    }
                    $('#selectContainer').html(html);
                },
                error: function (data) {
                    console.log(data);
                    alert('Ocurrió un error inesperado');
                }
            });
        }

     
        $('form').submit(function (ev) {
                type: 'POST',
                url: '/api/product',
                data: JSON.stringify(convertFormToJSON('#myForm')),
                dataType: 'json',
                contentType: 'application/json',
                success: function (data) {
                    console.log(data);
                    $('#alert').text('El formulario se envio correctamente');
                },
                error: function (data) {
                    console.log(data);
                    alert('Ocurrió un error inesperado');
                }
            });
 

        function convertFormToJSON(form) {            const array = $(form).serializeArray(); // Encodes the set of form elements as an array of names and values.            const json = {};            $.each(array, function () {                json[this.name] = this.value || "";            });            return json;        }

    </script>
}